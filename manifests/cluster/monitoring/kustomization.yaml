apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
- 0namespace-namespace.yaml
- alertmanager-alertmanager.yaml
- alertmanager-secret.yaml
- alertmanager-service.yaml
- alertmanager-serviceAccount.yaml
- alertmanager-serviceMonitor.yaml
- armexporter-clusterRole.yaml
- armexporter-clusterRoleBinding.yaml
- armexporter-daemonset.yaml
- armexporter-service.yaml
- armexporter-serviceAccount.yaml
- armexporter-serviceMonitor.yaml
- grafana-config.yaml
- grafana-dashboardDatasources.yaml
- grafana-dashboardDefinitions.yaml
- grafana-dashboardSources.yaml
- grafana-deployment.yaml
- grafana-service.yaml
- grafana-serviceAccount.yaml
- grafana-serviceMonitor.yaml
- ingress-alertmanager.yaml
- ingress-grafana.yaml
- ingress-prometheus.yaml
- kube-state-metrics-clusterRole.yaml
- kube-state-metrics-clusterRoleBinding.yaml
- kube-state-metrics-deployment.yaml
- kube-state-metrics-service.yaml
- kube-state-metrics-serviceAccount.yaml
- kube-state-metrics-serviceMonitor.yaml
- node-exporter-clusterRole.yaml
- node-exporter-clusterRoleBinding.yaml
- node-exporter-daemonset.yaml
- node-exporter-service.yaml
- node-exporter-serviceAccount.yaml
- node-exporter-serviceMonitor.yaml
- prometheus-adapter-apiService.yaml
- prometheus-adapter-clusterRole.yaml
- prometheus-adapter-clusterRoleAggregatedMetricsReader.yaml
- prometheus-adapter-clusterRoleBinding.yaml
- prometheus-adapter-clusterRoleBindingDelegator.yaml
- prometheus-adapter-clusterRoleServerResources.yaml
- prometheus-adapter-configMap.yaml
- prometheus-adapter-deployment.yaml
- prometheus-adapter-roleBindingAuthReader.yaml
- prometheus-adapter-service.yaml
- prometheus-adapter-serviceAccount.yaml
- prometheus-clusterRole.yaml
- prometheus-clusterRoleBinding.yaml
- prometheus-kubeControllerManagerPrometheusDiscoveryEndpoints.yaml
- prometheus-kubeControllerManagerPrometheusDiscoveryService.yaml
- prometheus-kubeDnsPrometheusDiscoveryService.yaml
- prometheus-kubeSchedulerPrometheusDiscoveryEndpoints.yaml
- prometheus-kubeSchedulerPrometheusDiscoveryService.yaml
- prometheus-operator-0alertmanagerCustomResourceDefinition.yaml
- prometheus-operator-0podmonitorCustomResourceDefinition.yaml
- prometheus-operator-0prometheusCustomResourceDefinition.yaml
- prometheus-operator-0prometheusruleCustomResourceDefinition.yaml
- prometheus-operator-0servicemonitorCustomResourceDefinition.yaml
- prometheus-operator-0thanosrulerCustomResourceDefinition.yaml
- prometheus-operator-clusterRole.yaml
- prometheus-operator-clusterRoleBinding.yaml
- prometheus-operator-deployment.yaml
- prometheus-operator-service.yaml
- prometheus-operator-serviceAccount.yaml
- prometheus-operator-serviceMonitor.yaml
- prometheus-prometheus.yaml
- prometheus-roleBindingConfig.yaml
- prometheus-roleBindingSpecificNamespaces.yaml
- prometheus-roleConfig.yaml
- prometheus-roleSpecificNamespaces.yaml
- prometheus-rules.yaml
- prometheus-service.yaml
- prometheus-serviceAccount.yaml
- prometheus-serviceMonitor.yaml
- prometheus-serviceMonitorApiserver.yaml
- prometheus-serviceMonitorCoreDNS.yaml
- prometheus-serviceMonitorKubeControllerManager.yaml
- prometheus-serviceMonitorKubeScheduler.yaml
- prometheus-serviceMonitorKubelet.yaml
- speedtestexporter-deployment.yaml
- speedtestexporter-service.yaml
- speedtestexporter-serviceMonitor.yaml

patches:
  - patch: |-
      - op: add
        path: /spec/template/spec/affinity
        value:
          nodeAffinity:
            preferredDuringSchedulingIgnoredDuringExecution:
              - weight: 1
                preference:
                  matchExpressions:
                    - key: node-type
                      operator: In
                      values:
                        - raspberry-pi
    target:
      kind: Deployment

  - patch: |-
      - op: add
        path: /spec/template/spec/affinity
        value:
          nodeAffinity:
            preferredDuringSchedulingIgnoredDuringExecution:
              - weight: 1
                preference:
                  matchExpressions:
                    - key: node-type
                      operator: In
                      values:
                        - raspberry-pi
    target:
      kind: DaemonSet

  - patch: |-
      - op: add
        path: /spec/template/spec/affinity
        value:
          nodeAffinity:
            preferredDuringSchedulingIgnoredDuringExecution:
              - weight: 1
                preference:
                  matchExpressions:
                    - key: node-type
                      operator: In
                      values:
                        - raspberry-pi
    target:
      kind: StatefulSet